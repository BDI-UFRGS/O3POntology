name: Deploy Ontology Docs

on:
  push:
    branches:
      - main
    paths:
      - '**.ttl'
      - '.github/workflows/widoco.yml'

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'

      # Passo de DEBUG 1: Mostra onde estamos e o que tem na pasta
      - name: üîç Debug - List files in root
        run: ls -R

      - name: Download Widoco
        # Voltando para a vers√£o 1.4.23 que √© "bala de prata" (funciona sempre)
        run: wget https://github.com/dgarijo/Widoco/releases/download/v1.4.23/widoco-1.4.23-jar-with-dependencies.jar -O widoco.jar

      - name: Generate Documentation
        run: |
          mkdir -p public
          
          # --- CONFIRME SE O NOME EST√Å CERTO ---
          ONTOLOGY_FILE="o3po.ttl" 
          # -------------------------------------

          # Verifica se o arquivo existe antes de rodar o Java
          if [ ! -f "$ONTOLOGY_FILE" ]; then
            echo "‚ùå ERRO CR√çTICO: O arquivo $ONTOLOGY_FILE n√£o foi encontrado na raiz!"
            exit 1
          fi

          echo "üöÄ Iniciando Widoco para: $ONTOLOGY_FILE"

          # Removi o -oops para evitar travar
          java -jar widoco.jar \
            -ontFile $ONTOLOGY_FILE \
            -outFolder public \
            -rewriteAll \
            -webVowl \
            -lang en-pt \
            -getOntologyMetadata

          # Verifica se gerou algo
          ls -l public/

          # Copia o index em ingl√™s para ser a home page
          if [ -f "public/index-en.html" ]; then
             cp public/index-en.html public/index.html
             echo "‚úÖ index.html criado com sucesso!"
          else
             echo "‚ö†Ô∏è AVISO: index-en.html n√£o foi gerado. O Widoco falhou?"
          fi

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: public
          branch: gh-pages
