name: Generate Documentation (Java Mode)
run-name: ${{ github.actor }} is generating ontology docs via JAR ☕
on:
  push:
    paths:
      - 'o3po.ttl' # Só roda se mudar a ontologia
      - '.github/workflows/widoco.yaml' # Ou se mudar este arquivo
jobs:
  build-docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Necessário para fazer commit e push
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
      - name: Download Widoco JAR
        run: |
          # Baixa a última versão estável do Widoco direto do GitHub
          wget https://github.com/dgarijo/Widoco/releases/download/v1.4.25/widoco-1.4.25-jar-with-dependencies_JDK-11.jar -O widoco.jar
      - name: Run Widoco
        run: |
          # Cria a pasta de saída
          mkdir -p docs
          
          # Roda o Java direto (sem Docker)
          java -jar widoco.jar \
            -ontFile o3po.ttl \
            -outFolder docs \
            -rewriteAll \
            -webVowl \
            -lang en-pt \
            -getOntologyMetadata \
            -oops
            
          # Ajusta o index.html (Inglês como padrão)
          if [ -f "docs/index-en.html" ]; then
             cp docs/index-en.html docs/index.html
          fi
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          publish_branch: gh-pages
          commit_message: "docs: update ontology documentation (automated)"
